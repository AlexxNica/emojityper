{"version":3,"sources":["src/support/check.js","node_modules/promise-polyfill/promise.min.js","node_modules/regenerator-runtime/runtime.js","src/support/polyfill.js","src/lib/modifier.js","src/input.js","src/lib/prefixgen.js","src/lib/provider.js","src/options.js","src/polyfill.js","src/buttons.js","src/selection.js"],"names":["window","location","search","indexOf","Map","WeakMap","e","n","t","apply","arguments","o","this","TypeError","_state","_handled","_value","_deferreds","s","i","push","_immediateFn","onFulfilled","onRejected","u","promise","r","then","f","length","_unhandledRejectionFn","c","a","setTimeout","prototype","constructor","all","Array","slice","call","resolve","reject","race","setImmediate","console","warn","_setImmediateFn","_setUnhandledRejectionFn","module","exports","Promise","global","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","Object","create","context","Context","_invoke","makeInvokeMethod","tryCatch","fn","obj","arg","type","err","GeneratorFunction","GeneratorFunctionPrototype","defineIteratorMethods","forEach","method","AsyncIterator","invoke","record","result","value","hasOwn","__await","unwrapped","babelHelpers.typeof","process","domain","bind","previousPromise","callInvokeWithMethodAndArg","state","GenStateSuspendedStart","GenStateExecuting","Error","GenStateCompleted","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","done","GenStateSuspendedYield","iterator","undefined","return","info","resultName","next","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","values","iterable","iteratorMethod","iteratorSymbol","isNaN","Op","hasOwnProperty","$Symbol","Symbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","runtime","regeneratorRuntime","IteratorPrototype","getProto","getPrototypeOf","NativeIteratorPrototype","Gp","displayName","isGeneratorFunction","genFun","ctor","name","mark","setPrototypeOf","__proto__","awrap","async","iter","toString","keys","object","key","reverse","pop","skipTempReset","prev","charAt","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","thrown","CustomEvent","params","bubbles","cancelable","detail","event","document","createEvent","initCustomEvent","Event","String","startsWith","from","substr","isPointGender","p","isPersonGender","isFamilyMember","isVariationSelector","isDiversitySelector","isFlagPoint","unlikelyModifierBase","jsdecode","len","points","raw","charCodeAt","extra","splitEmoji","curr","point","suffix","out","check","modify","opt_op","stats","diversity","gender","single","double","neutral","chars","some","char","first","genderable","family","ch","flip","genderFlip","isSinglePerson","basicDiversity","candidate","fromCodePoint","isSingle","nextGenderPoint","g","previousMaster","index","master","opt_point","opt_allowOtherFlip","m","map","allowOtherFlip","genderPoint","reduce","concat","datasetSafeDelete","el","d","dataset","build","prefixLength","maxSuggestions","prefixSuggest","k","data","prefix","part","opts","typed","rest","toLowerCase","filter","word","options","request","text","requestAnimationFrame","select","emoji","clearTimeout","timeoutSelect","body","JSON","stringify","pendingSelect","fetch","api","submit","FormData","append","mode","createButton","buttonCache","get","button","createElement","textContent","set","requestIdleCallback","start","performance","now","callback","Math","max","cancelIdleCallback","id","buttons","querySelectorAll","handler","ev","typer","trim","hasValue","Boolean","classList","toggle","disabled","addEventListener","input","timeout","defaultText","spaceRe","copy","selectionStart","selectionEnd","end","left","right","exec","focus","ok","execCommand","copied","click","measureText","getContext","font","cache","count","width","fixedWidthEmoji","emojiWidth","invalidWidth","isExpectedLength","flags","total","expectedLength","ceil","floor","list","j","v","has","isWordCode","code","helper","className","parentNode","insertBefore","underline","appendChild","sizer","readyState","add","remove","renderLine","hidden","to","getBoundingClientRect","getElementById","style","transform","scrollLeft","setRange","initialLength","changeHandler","permitNextChange","dispatchEvent","isNotWordAfter","mergedEventHandler","events","frame","Set","dedup","clear","split","which","dedupRenderLine","passive","replaceFocus","update","drift","where","modifier","choice","indexed","parse","localStorage","Date","debug","json","local","requestCallback","performRequest","send","localTimeout","url","encodeURIComponent","results","arr","suggest","invalidLetterRe","simplifyWord","replace","chooser","b","target","localName","querySelector","activeElement","contains","buttonArray","delta","previousRect","best","dist","Infinity","targetTop","candidateRect","top","abs","savedResults","query","canary","updatedButtonCache","holderFor","h4","createModifierButton","holder","opt_value","genderHolder","diversityHolder","replacement","createDocumentFragment","holders","option","idle","timeRemaining","catch","advanced","form","namer","selection","preventDefault","provider"],"mappings":"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","file":"support.min.js","sourcesContent":["\nif (!window.location.search || window.location.search.indexOf('ignore_check') === -1) {\n  const support = true && window.Map && window.WeakMap;\n  if (!support) {\n    window.location = 'error.html';\n  }\n}\n","!function(e){function n(){}function t(e,n){return function(){e.apply(n,arguments)}}function o(e){if(\"object\"!=typeof this)throw new TypeError(\"Promises must be constructed via new\");if(\"function\"!=typeof e)throw new TypeError(\"not a function\");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function i(e,n){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(n):(e._handled=!0,void o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null===t)return void(1===e._state?r:u)(n.promise,e._value);var o;try{o=t(e._value)}catch(i){return void u(n.promise,i)}r(n.promise,o)}))}function r(e,n){try{if(n===e)throw new TypeError(\"A promise cannot be resolved with itself.\");if(n&&(\"object\"==typeof n||\"function\"==typeof n)){var i=n.then;if(n instanceof o)return e._state=3,e._value=n,void f(e);if(\"function\"==typeof i)return void s(t(i,n),e)}e._state=1,e._value=n,f(e)}catch(r){u(e,r)}}function u(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled=\"function\"==typeof e?e:null,this.onRejected=\"function\"==typeof n?n:null,this.promise=t}function s(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,u(n,e))})}catch(o){if(t)return;t=!0,u(n,o)}}var a=setTimeout;o.prototype[\"catch\"]=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var o=new this.constructor(n);return i(this,new c(e,t,o)),o},o.all=function(e){var n=Array.prototype.slice.call(e);return new o(function(e,t){function o(r,u){try{if(u&&(\"object\"==typeof u||\"function\"==typeof u)){var f=u.then;if(\"function\"==typeof f)return void f.call(u,function(e){o(r,e)},t)}n[r]=u,0===--i&&e(n)}catch(c){t(c)}}if(0===n.length)return e([]);for(var i=n.length,r=0;r<n.length;r++)o(r,n[r])})},o.resolve=function(e){return e&&\"object\"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){for(var o=0,i=e.length;o<i;o++)e[o].then(n,t)})},o._immediateFn=\"function\"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){\"undefined\"!=typeof console&&console&&console.warn(\"Possible Unhandled Promise Rejection:\",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},\"undefined\"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this);","/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var Op = Object.prototype;\n  var hasOwn = Op.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  // This is a polyfill for %IteratorPrototype% for environments that\n  // don't natively support it.\n  var IteratorPrototype = {};\n  IteratorPrototype[iteratorSymbol] = function () {\n    return this;\n  };\n\n  var getProto = Object.getPrototypeOf;\n  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  if (NativeIteratorPrototype &&\n      NativeIteratorPrototype !== Op &&\n      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {\n    // This environment has a native %IteratorPrototype%; use it instead\n    // of the polyfill.\n    IteratorPrototype = NativeIteratorPrototype;\n  }\n\n  var Gp = GeneratorFunctionPrototype.prototype =\n    Generator.prototype = Object.create(IteratorPrototype);\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] =\n    GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `hasOwn.call(value, \"__await\")` to determine if the yielded value is\n  // meant to be awaited.\n  runtime.awrap = function(arg) {\n    return { __await: arg };\n  };\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value &&\n            typeof value === \"object\" &&\n            hasOwn.call(value, \"__await\")) {\n          return Promise.resolve(value.__await).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof global.process === \"object\" && global.process.domain) {\n      invoke = global.process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n  AsyncIterator.prototype[asyncIteratorSymbol] = function () {\n    return this;\n  };\n  runtime.AsyncIterator = AsyncIterator;\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      context.method = method;\n      context.arg = arg;\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          var delegateResult = maybeInvokeDelegate(delegate, context);\n          if (delegateResult) {\n            if (delegateResult === ContinueSentinel) continue;\n            return delegateResult;\n          }\n        }\n\n        if (context.method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = context.arg;\n\n        } else if (context.method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw context.arg;\n          }\n\n          context.dispatchException(context.arg);\n\n        } else if (context.method === \"return\") {\n          context.abrupt(\"return\", context.arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          if (record.arg === ContinueSentinel) {\n            continue;\n          }\n\n          return {\n            value: record.arg,\n            done: context.done\n          };\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(context.arg) call above.\n          context.method = \"throw\";\n          context.arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Call delegate.iterator[context.method](context.arg) and handle the\n  // result, either by returning a { value, done } result from the\n  // delegate iterator, or by modifying context.method and context.arg,\n  // setting context.delegate to null, and returning the ContinueSentinel.\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n    if (method === undefined) {\n      // A .throw or .return when the delegate iterator has no .throw\n      // method always terminates the yield* loop.\n      context.delegate = null;\n\n      if (context.method === \"throw\") {\n        if (delegate.iterator.return) {\n          // If the delegate iterator has a return method, give it a\n          // chance to clean up.\n          context.method = \"return\";\n          context.arg = undefined;\n          maybeInvokeDelegate(delegate, context);\n\n          if (context.method === \"throw\") {\n            // If maybeInvokeDelegate(context) changed context.method from\n            // \"return\" to \"throw\", let that override the TypeError below.\n            return ContinueSentinel;\n          }\n        }\n\n        context.method = \"throw\";\n        context.arg = new TypeError(\n          \"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n\n    if (record.type === \"throw\") {\n      context.method = \"throw\";\n      context.arg = record.arg;\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    var info = record.arg;\n\n    if (! info) {\n      context.method = \"throw\";\n      context.arg = new TypeError(\"iterator result is not an object\");\n      context.delegate = null;\n      return ContinueSentinel;\n    }\n\n    if (info.done) {\n      // Assign the result of the finished delegate to the temporary\n      // variable specified by delegate.resultName (see delegateYield).\n      context[delegate.resultName] = info.value;\n\n      // Resume execution at the desired location (see delegateYield).\n      context.next = delegate.nextLoc;\n\n      // If context.method was \"throw\" but the delegate handled the\n      // exception, let the outer generator proceed normally. If\n      // context.method was \"next\", forget context.arg since it has been\n      // \"consumed\" by the delegate iterator. If context.method was\n      // \"return\", allow the original .return call to continue in the\n      // outer generator.\n      if (context.method !== \"return\") {\n        context.method = \"next\";\n        context.arg = undefined;\n      }\n\n    } else {\n      // Re-yield the result returned by the delegate method.\n      return info;\n    }\n\n    // The delegate iterator is finished, so forget it and continue with\n    // the outer generator.\n    context.delegate = null;\n    return ContinueSentinel;\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  // A Generator should always return itself as the iterator object when the\n  // @@iterator function is called on it. Some browsers' implementations of the\n  // iterator prototype chain incorrectly implement this, causing the Generator\n  // object to not be returned from this call. This ensures that doesn't happen.\n  // See https://github.com/facebook/regenerator/issues/274 for more details.\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.method = \"next\";\n      this.arg = undefined;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n\n        if (caught) {\n          // If the dispatched exception was caught by a catch block,\n          // then let that catch block handle the exception normally.\n          context.method = \"next\";\n          context.arg = undefined;\n        }\n\n        return !! caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.method = \"next\";\n        this.next = finallyEntry.finallyLoc;\n        return ContinueSentinel;\n      }\n\n      return this.complete(record);\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = this.arg = record.arg;\n        this.method = \"return\";\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n\n      return ContinueSentinel;\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      if (this.method === \"next\") {\n        // Deliberately forget the last sent value so that we don't\n        // accidentally pass it on to the delegate.\n        this.arg = undefined;\n      }\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n","\n/**\n * @fileoverview Polyfills included for Emojityper on non-module browsers.\n */\n\nif (typeof window.CustomEvent !== 'function') {\n  function CustomEvent(name, params) {\n    params = params || {bubbles: false, cancelable: false, detail: undefined};\n    const event = document.createEvent('CustomEvent');\n    event.initCustomEvent(name, params.bubbles, params.cancelable, params.detail);\n    return event;\n  }\n  CustomEvent.prototype = window.Event.prototype;\n  window.CustomEvent = CustomEvent;\n}\n\nif (!String.prototype.startsWith) {\n  String.prototype.startsWith = function(search, from) {\n    return this.substr(from || 0, search.length) === search;\n  };\n}\n\nif (!Array.from) {\n  Array.from = function(arg) {\n    // TODO: this isn't the whole polyfill, but it's good for now: just for rollup generated code\n    return Array.prototype.slice.call(arg);\n  };\n}\n\n// for Promise\nimport Promise from '../../node_modules/promise-polyfill/promise.min.js';\nif (!window.Promise) {\n  window.Promise = Promise;\n}\n\n// for async/await magic\n// nb. this puts regeneratorRuntime into the top-level scope\nimport '../../node_modules/regenerator-runtime/runtime.js';\n","\n/**\n * @param {string} string to measure\n * @return {number} length of text in monospace units\n */\nconst measureText = (function() {\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d');\n  context.font = '1px monospace';\n\n  let cache = {};\n  let count = 0;\n\n  return s => {\n    let result = cache[s];\n    if (result === undefined) {\n      cache[s] = result = context.measureText(s).width;\n      if (++count > 4000) {\n        // nb. at June 2017, there's about ~1,800 emojis including variations, so this number is\n        // probably greater than we'll ever use: still, empty if it's too big\n        cache = {};\n        count = 0;\n      }\n    }\n    return result;\n  };\n}());\n\n/**\n * @type {boolean} whether this platform probably has fixed width emoji\n */\nconst fixedWidthEmoji = Boolean(/Mac|Android|iP(hone|od|ad)/);\n\n/**\n * @param {string} string to measure\n * @return {boolean} whether this is a single char long (and probably a single emoji)\n */\nconst isSingle = (function() {\n  if (fixedWidthEmoji) {\n    // get a baseline emoji width: this is the well-supported 'FACE WITH TEARS OF JOY'\n    const emojiWidth = measureText('\\u{1f602}');\n    return s => measureText(s) === emojiWidth;\n  }\n  const invalidWidth = context.measureText('\\u{ffffd}').width;\n  return s => {\n    const width = measureText(s);\n    return width !== invalidWidth && width < invalidWidth * 2;\n  };\n}());\n\n/**\n * Is this string rendering correctly as an emoji or sequence of emojis? On variable width\n * platforms, this can take O(n).\n *\n * @param {string} string to check\n * @return {boolean} whether this is probably an emoji\n */\nexport const isExpectedLength = (function() {\n  if (fixedWidthEmoji) {\n    // use 'FACE WITH TEARS OF JOY'\n    const emojiWidth = measureText('\\u{1f602}');\n    return s => {\n      // emojis could be _smaller_ than expected, but not larger- and not random non-unit widths\n      const points = jsdecode(s);\n      const chars = splitEmoji(points);\n\n      // count flags, reduce expected by / 2\n      const flags = chars.reduce((total, char) => total += isFlagPoint(char[0].point) ? 1 : 0, 0);\n      const expectedLength = chars.length - Math.ceil(flags / 2);\n\n      const width = measureText(s) / emojiWidth;\n\n      // does this have non-emoji characters in it?\n      if (Math.floor(width) !== width) { return false; }\n\n      // otherwise, as long as we're equal or smaller\n      return width <= expectedLength;\n    };\n  }\n\n  const invalidWidth = context.measureText('\\u{ffffd}').width;\n  return s => {\n    const points = jsdecode(s);\n    const chars = splitEmoji(points);\n\n    for (let i = 0; i < chars.length; ++i) {\n      const char = chars[i];\n      if (isFlagPoint(char[0].point)) {\n        if (i === chars.length - 1 || !isFlagPoint(char[i+1].point)) {\n          return false;  // only one single flag point\n        }\n\n        const s = String.fromCodePoint(...char[i].point, char[i+1].point);\n        if (!isSingle(s)) {\n          return false;  // can't render this flag\n        }\n\n        ++i;  // eaten next flag char\n        continue;\n      }\n\n      // otherwise, measure this particular point and ensure it's single.\n      const s = String.fromCodePoint(...char.map(c => c.point));\n      if (!isSingle(s)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n}());\n\n/**\n * True if the standard \"female\" icon can be varied with a diversity modifier. This is the basic\n * level of emoji diversity support, but doesn't imply support for all the professions.\n *\n * @type {boolean}\n */\nconst basicDiversity = (measureText('\\u{1f468}\\u{1f3fb}') === measureText('\\u{1f468}'));\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a gender character\n */\nfunction isPointGender(p) {\n  return p === 0x2640 || p === 0x2642;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a basic emoji person gender: Man or Woman\n */\nfunction isPersonGender(p) {\n  return p === 0x1f468 || p === 0x1f469;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether this is a subordinate member of a family sequence: boy/girl/baby\n */\nfunction isFamilyMember(p) {\n  return p === 0x1f476 || p === 0x1f466 || p === 0x1f467;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a Variation_Selector\n */\nfunction isVariationSelector(p) {\n  return (p >= 0xfe00 && p <= 0xfe0f) || (p >= 0xe0100 && p <= 0xe01ef);\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is a diversity selector (one of five skin tones)\n */\nfunction isDiversitySelector(p) {\n  return p >= 0x1f3fb && p <= 0x1f3ff;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is one of A-Z for flags\n */\nfunction isFlagPoint(p) {\n  return p >= 0x1f1e6 && p <= 0x1f1ff;\n}\n\n/**\n * @param {number} p\n * @return {boolean} whether the passed rune is probably not a modifier base\n */\nfunction unlikelyModifierBase(p) {\n  return p < 0x261d || isPointGender(p) || isVariationSelector(p) || isDiversitySelector(p) ||\n      isFlagPoint(p);\n}\n\n/**\n * Decodes a JavaScript string into Unicode code points.\n *\n * @param {string} s to decode\n * @return {!Array<number>} code points\n */\nfunction jsdecode(s) {\n  const len = s.length;\n  const points = [];\n\n  for (let i = 0; i < len;) {\n    const raw = s.charCodeAt(i++) || 0;\n    if (raw < 0xd800 || raw > 0xdbff || i === len) {\n      // not a high surrogate, or end of string\n    } else {\n      const extra = s.charCodeAt(i) || 0;\n      if ((extra & 0xfc00) === 0xdc00) {\n        // got a low surrogate, eat 2nd char\n        ++i;\n        points.push(0x10000 + (extra & 0x3ff) + ((raw & 0x3ff) << 10));\n        continue;\n      }\n    }\n    points.push(raw);\n  }\n\n  return points;\n}\n\n/**\n * Returns details about a character and whether it can be gender flipped to a single or neutral\n * gender. This contains emojis which, due to historical emoji reasons, aren't officially versions\n * of each other: e.g., Santa and Mrs. Claus, or Old {Man,Woman,Adult}.\n *\n * @param {number} point to look up in the other gender flips table\n * @return {{single: boolean, neutral: boolean, points: {f: number, m: number, n: number}}?}\n */\nconst genderFlip = (function() {\n  // TODO: covers F/M/neutral, but _not_ mixed (e.g. holding hands => no m/f combo)\n  const list = [\n    0x1f936, 0x1f385, 0,        // mrs. claus, santa\n    0x1f483, 0x1f57a, 0,        // dancers\n    0x1f470, 0x1f935, 0,        // bride, man in tuxedo\n    0x1f467, 0x1f466, 0,        // girl, boy\n    0x1f475, 0x1f474, 0x1f9d3,  // old {woman,man,adult}\n    0x1f46d, 0x1f46c, 0,        // women/men holding hands\n    0x1f478, 0x1f934, 0,        // princess, prince\n  ];\n\n  // build map with raw data only\n  const all = new Map();\n  for (let i = 0; i < list.length; i += 3) {\n    const data = {\n      points: {f: list[i], m: list[i+1], n: list[i+2]},\n    };\n    for (let j = 0; j < 3; ++j) {\n      const v = list[i+j];\n      if (v) {\n        if (all.has(v)) {\n          throw new Error('duplicate in gender list: ' + v);\n        }\n        all.set(v, data);\n      }\n    }\n  }\n\n  // return helper\n  return point => {\n    const out = all.get(point) || null;\n    if (out && out.single === undefined) {\n      // do the heavy lifting only when first fetched\n      out.single = isSingle(String.fromCodePoint(out.points.f)) &&\n          isSingle(String.fromCodePoint(out.points.m));\n      out.neutral = out.points.n && isSingle(String.fromCodePoint(out.points.n));\n    }\n    return out;\n  };\n}());\n\n/**\n * Splits a single emoji into raw characters, removing variants or diversity modifiers. Each\n * sub-array represents a character previously split by ZWJs.\n *\n * @param {!Array<number>} points\n * @return {!Array<!Array<{point: number, suffix: number}>>}\n */\nfunction splitEmoji(points) {\n  if (!points.length) {\n    return [];\n  }\n  let curr = [{point: points[0], suffix: 0}];\n  const out = [curr];\n\n  // TODO: doesn't deal with flags or regional letters\n  // flags are weird: U + N + A, for instance, will render the Namibia flag where the UN flag is\n  // not supported (but the UN flag where it is)- taking the left-most valid code\n  // NOTE: the regional flag letters are seen as _emoji_ on their own, at least on Mac.\n\n  for (let i = 1; i < points.length; ++i) {\n    const check = points[i];\n\n    if (isFlagPoint(curr[curr.length-1].point)) {\n      // previous was a flag, create a new one\n    } else if (isDiversitySelector(check) || isVariationSelector(check)) {\n      // store in suffix\n      curr[curr.length-1].suffix = check;\n      continue;\n    } else if (check === 0x200d) {\n      // push next char onto curr\n      const next = points[++i];\n      next && curr.push({point: next, suffix: 0});\n      continue;\n    }\n\n    // new character, reset\n    curr = [{point: check, suffix: 0}];\n    out.push(curr);\n  }\n  return out;\n}\n\n/**\n * Analyses or modifes an emoji string for modifier support: diversity and gender.\n *\n * This might be O(n), including the cost of measuring every individual character via measureText.\n *\n * @param {string} s\n * @param {{diversity: undefined|number, gender: undefined|string}=} opt_op\n * @return {out: (string|undefined), diversity: boolean, gender: {single: boolean, double: boolean, neutral: boolean}}\n */\nexport function modify(s, opt_op) {\n  const points = jsdecode(s);\n  const stats = {diversity: false, gender: {single: false, double: false, neutral: false}};\n\n  // split out gender modifierss and other variations with splitEmoji, walk chars\n  const chars = splitEmoji(points);\n  const record = (opt_op ? [] : null);\n  chars.some((char, i) => {\n    const first = char[0].point;\n    let genderable = 0;\n    let family = false;\n\n    // search for existing gender characters\n    char.forEach(ch => {\n      const p = ch.point;\n      if (isPointGender(p)) {\n        // we can remove or replace the point\n        stats.gender.single = true;\n        stats.gender.neutral = true;\n      } else if (isPersonGender(p)) {\n        // easily swappable person\n        stats.gender.single = true;\n        if (++genderable >= 2) {\n          stats.gender.double = true;\n        }\n      } else if (isFamilyMember(p) && genderable) {\n        // this run is a family (child and already has parent), so it can't be made diverse\n        family = true;\n      } else {\n        // look for potential gender flips\n        const flip = genderFlip(p);\n        if (flip) {\n          stats.gender.single |= flip.single;\n          stats.gender.neutral |= flip.neutral;\n        }\n      }\n    });\n\n    // check for professions ('non family person'): single initial person gender, not a family\n    const isSinglePerson =\n        genderable ? (isPersonGender(first) && genderable === 1 && !family) : undefined;\n    if (isSinglePerson) {\n      stats.diversity = basicDiversity;\n    }\n    if (record) {\n      // true: is a 'non family person', aka profession or disembodied head (diversity OK)\n      // false: is a family or other combined group of persons (no diversity)\n      // undefined: something else\n      record[i] = isSinglePerson;\n    }\n\n    // check for early exhaustive answer\n    if ((stats.diversity || !basicDiversity) && stats.gender.neutral) {\n      // ... don't finish 'some' early if we're recording gender data\n      return !record && stats.gender.single && stats.gender.double;\n    }\n\n    // skip if profession, low emojis (everything below Emoji_Modifier_Base) and male/female signs\n    if (isSinglePerson === false || unlikelyModifierBase(first)) { return; }\n\n    // do slow measure checks\n    // TODO: can we use \\p{Modifier_Base} as a faster check than measureText for +ve case?\n    const candidate = String.fromCodePoint(first);\n    if (basicDiversity && !stats.diversity && isSingle(candidate + '\\u{1f3fb}')) {\n      stats.diversity = true;\n    }\n    if (!stats.gender.neutral && isSingle(candidate + '\\u{200d}\\u{2640}\\u{fe0f}')) {\n      stats.gender.neutral = true;\n      stats.gender.single = true;\n    }\n  });\n\n  // early out without op\n  if (!opt_op) {\n    return stats;\n  }\n\n  // gender helper: modifies passed character to apply next gender (or returns new ch)\n  const nextGenderPoint = (function() {\n    const g = opt_op.gender || '';\n    let previousMaster;\n    let index;\n    return (master, opt_point, opt_allowOtherFlip) => {\n      if (previousMaster === undefined || master !== previousMaster) {\n        previousMaster = master;\n        index = 0;\n      } else {\n        ++index;\n      }\n      const next = g ? g[index % g.length] : '';\n      const point = opt_point || 0;\n      if (isPersonGender(point)) {\n        // if this is a person, return the alternative person (or make no change)\n        return next ? (next === 'm' ? 0x1f468 : 0x1f469) : point;\n      } else if (!point || isPointGender(point)) {\n        // if this is a point, return the alternative point (or clear)\n        return next ? (next === 'm' ? 0x2642 : 0x2640) : 0;\n      } else if (opt_allowOtherFlip) {\n        // do other gender flips: note that some of these have F/M/N, but not all have N\n        const flip = genderFlip(point);\n        if (flip) {\n          if (!next && flip.neutral) {\n            return flip.points.n;\n          } else if (next && flip.single) {\n            return next === 'm' ? flip.points.m : flip.points.f;\n          }\n        }\n      }\n      // didn't consume anything\n      --index;\n      return point;\n    };\n  }());\n\n  // walk over all chars, apply change\n  const out = chars.map((char, i) => {\n    const points = [];  // used as nonce, declare first\n    const isSinglePerson = record[i];\n    const first = char[0].point;\n\n    if (opt_op.gender !== undefined) {\n      // replace/remove existing male/female characters\n      // nb. this removes orphaned gender point characters\n      const allowOtherFlip = (isSinglePerson === undefined);  // not for family/profession\n      char.forEach(ch => ch.point = nextGenderPoint(points, ch.point, allowOtherFlip));\n\n      // under various conditions, add a gender modifier to a single point\n      if (isSinglePerson === undefined && char.length === 1 && !isPointGender(first)) {\n        const genderPoint = nextGenderPoint(points);\n        if (genderPoint && isSingle(String.fromCodePoint(first) + '\\u{200d}\\u{2640}\\u{fe0f}')) {\n          char.push({suffix: 0xfe0f, point: genderPoint});\n        }\n      }\n    }\n\n    // apply diversity\n    if (opt_op.diversity !== undefined) {\n      char.forEach((ch, i) => {\n        if (isDiversitySelector(ch.suffix)) {\n          // always tweak existing diversity modifiers\n          ch.suffix = opt_op.diversity;\n        } else if (i === 0 && basicDiversity && isSinglePerson !== false) {\n          // if it's the first point in a non-family, try to apply diversity\n          if (isSinglePerson || isSingle(String.fromCodePoint(first) + '\\u{1f3fb}')) {\n            ch.suffix = opt_op.diversity;\n          }\n        }\n      });\n    }\n\n    // flatten into actual codepoints again\n    char.forEach(ch => {\n      if (ch.point) {\n        points.length && points.push(0x200d);\n        points.push(ch.point);\n        ch.suffix && points.push(ch.suffix);\n      }\n    });\n    return points;\n  }).reduce((all, points) => all.concat(points), []);\n\n  stats.out = String.fromCodePoint(...out);\n  return stats;\n};\n","\nimport * as modifier from './lib/modifier.js';\n\nfunction datasetSafeDelete(el, ...keys) {\n  const d = el.dataset;\n  keys.forEach(key => {\n    if (key in d) {\n      delete d[key];\n    }\n  });\n}\n\n// word focus handler\nfunction upgrade(el) {\n  const isWordCode = code => {\n    // FIXME: turns out matching non-emoji is hard\n    // TODO: this RegExp _might_ work but it needs transpiling-\n    // new RegExp(/(?:[\\p{Letter}\\p{Number}\\p{Punctuation}](?!\\u{fe0f}?\\u{20e3}))+/u);\n    return code < 5000 && code != 32;\n  };\n\n  const helper = document.createElement('div');\n  helper.className = 'overflow-helper';\n  el.parentNode.insertBefore(helper, el);\n\n  const underline = document.createElement('div');\n  underline.className = 'underline';\n  helper.appendChild(underline);\n\n  const sizer = document.createElement('div');\n  sizer.className = 'sizer';\n  helper.appendChild(sizer);\n\n  // hide underline until load: the font used might not be ready, so it's probably out of whack\n  if (document.readyState !== 'complete') {\n    underline.classList.add('loading');\n    window.addEventListener('load', ev => {\n      renderLine();\n      underline.classList.remove('loading');\n    });\n  }\n\n  const renderLine = _ => {\n    if (el.dataset.from === undefined) {\n      underline.hidden = true;\n      return false;\n    }\n    const [from, to] = [+el.dataset.from, +el.dataset.to];\n\n    // otherwise, record and draw the line\n    const indent = 15;  // FIXME: from CSS, to match `text-indent`\n    sizer.textContent = el.value.substr(0, from);\n    const left = (from ? sizer.getBoundingClientRect().width : indent);\n\n    sizer.textContent = el.value.substr(from, to - from);\n    const width = sizer.getBoundingClientRect().width - indent;\n\n    if (width < 0 && !document.getElementById('less')) {\n      // nb. this seems to happen in dev with lesscss\n      console.warn('invalid sizer width', width, 'for text', sizer.textContent);\n    }\n\n    underline.hidden = width <= 0;\n    underline.style.left = left + 'px';\n    underline.style.width = width + 'px';\n    underline.style.transform = 'translateX(-' + el.scrollLeft + 'px)';\n  };\n\n  // force selection\n  const setRange = (from, to) => {\n    if (from >= to) {\n      datasetSafeDelete(el, 'from', 'to', 'prefix', 'word', 'focus');\n      underline.hidden = true;\n      return false;\n    }\n    [el.dataset.from, el.dataset.to] = [from, to];\n    el.dataset['focus'] = el.value.substr(from, to - from);\n    renderLine();\n    return true;\n  };\n\n  // state/handler keep track of the current focus word (plus scroll position, if input is big)\n  const initialLength = el.value.length;\n  const state = {start: initialLength, end: initialLength, value: undefined};\n  const changeHandler = permitNextChange => {\n    if (permitNextChange !== false &&\n        el.selectionStart === state.start &&\n        el.selectionEnd === state.end &&\n        el.value === state.value) {\n      return true;  // already at this state\n    }\n    [state.start, state.end] = [el.selectionStart, el.selectionEnd];\n    if (state.value !== el.value) {\n      el.dispatchEvent(new CustomEvent('value', {detail: el.value}));\n      state.value = el.value;\n    }\n\n    // range selection, magic\n    if (state.start !== state.end) {\n      datasetSafeDelete(el, 'prefix', 'word');\n\n      setRange(state.start, state.end);\n\n      underline.classList.add('range');\n      el.classList.add('range');\n      return false;\n    }\n    underline.classList.remove('range');\n    el.classList.remove('range');\n\n    // calculate from/to locally\n    let from = state.start;\n    let to = state.start;\n\n    // are we at the end (only have spaces until end)?\n    const isAtEnd = !el.value.substr(state.end).trim();\n    const isNotWordAfter = isAtEnd || !isWordCode(el.value.charCodeAt(state.end));\n\n    if (isNotWordAfter) {\n      for (; to > 0; --to) {\n        if (el.value.charCodeAt(to - 1) !== 32) {\n          break;\n        }\n      }\n      if (to < from) {\n        from = to;\n      }\n    }\n\n    // walk backwards while the previous character is a word\n    for (; from > 0; --from) {\n      if (!isWordCode(el.value.charCodeAt(from - 1))) {\n        break;\n      }\n    }\n\n    // walk forwards while the next char is not a space\n    for (; to < el.value.length; ++to) {\n      if (!isWordCode(el.value.charCodeAt(to))) {\n        break;\n      }\n    }\n\n    // if it's invalid, but there's not a word after, and we were permitted, ignore\n    if (from >= to && isNotWordAfter && permitNextChange) { return; }\n    if (setRange(from, to)) {\n      // if the range was valid, update the prefix/focus but delete the word (in typing state)\n      el.dataset['focus'] = el.dataset['prefix'] = el.value.substr(from, to - from);\n      datasetSafeDelete(el, 'word');\n    }\n  };\n\n  // runs change handler and emits the 'word' event as appropriate\n  const mergedEventHandler = (events, permitNextChange) => {\n    // if there was a focus event, don't let the browser take over: reset previous known good\n    if (events.has('focus')) {\n      // only if it wasn't a range selection (otherwise clicking back retains range, weird)\n      if (state.start === state.end) {\n        // TODO: this sets on initial load, even though it probably doesn't need to\n        [el.selectionStart, el.selectionEnd] = [state.start, state.end];\n      }\n    }\n\n    // run change handler: if true, nothing changed\n    if (changeHandler(permitNextChange)) { return; }\n\n    // send query: prefix or whole-word\n    let text = el.dataset.prefix || el.dataset.word || null;\n    const detail = {text, prefix: 'prefix' in el.dataset, focus: el.dataset.focus};\n    el.dispatchEvent(new CustomEvent('query', {detail}));\n  };\n\n  // dedup listeners on a rAF\n  let permitNextChange;  // FIXME: global-ish scope is ugly\n  (function() {\n    let frame;\n    let events = new Set();  // records the events that occured to cause this\n    const dedup = ev => {\n      if (!frame) {\n        permitNextChange = undefined;\n        events.clear();\n        frame = window.requestAnimationFrame(_ => {\n          frame = null;\n          mergedEventHandler(events, permitNextChange);\n        });\n      }\n      ev && events.add(ev.type);\n    };\n\n    // lots of listeners for a million different change reasons\n    const rest = 'change keydown keypress focus click mousedown select input';\n    rest.split(/\\s+/).forEach(event => el.addEventListener(event, dedup));\n    dedup();\n\n    el.addEventListener('mousemove', ev => {\n      if (ev.which) {\n        dedup();\n      }\n    })\n\n  }());\n\n  // on blur, after a backspace, Chrome moves the start/end selection: fix it\n  el.addEventListener('blur', ev => {\n    if (el.selectionStart !== state.start || el.selectionStart !== state.end) {\n      [el.selectionStart, el.selectionEnd] = [state.start, state.end];\n    }\n  });\n\n  // add a non-deduped keydown handler, to run before others and intercept space\n  el.addEventListener('keydown', ev => {\n    switch (ev.key) {\n    case 'Escape':\n      permitNextChange = false;  // force next change\n      break;\n\n    case ' ':\n      if (el.dataset.prefix && el.selectionStart === +el.dataset.to) {\n        el.dispatchEvent(new CustomEvent('request', {detail: el.dataset.prefix}));\n      }\n\n      // TODO: do this to prevent actually space being hit (as \"Sam Prefers\")\n      //ev.preventDefault();\n      break;\n    }\n  });\n\n  // dedup re-rendering calls\n  (function() {\n    let frame;\n    const dedupRenderLine = _ => {\n      if (!frame) {\n        frame = window.requestAnimationFrame(_ => {\n          frame = null;\n          renderLine();\n        });\n      }\n    };\n    window.addEventListener('resize', dedupRenderLine);\n    el.addEventListener('wheel', dedupRenderLine, {passive: true});\n  }());\n\n  // replace helper\n  const replaceFocus = call => {\n    if (el.dataset.from === undefined || el.dataset.to === undefined) { return false; }\n\n    const [from, to] = [+el.dataset.from, +el.dataset.to];\n    const value = el.value.substr(from, to - from);\n    let [start, end] = [typer.selectionStart, typer.selectionEnd];\n\n    const update = call(value);\n    if (update == null) { return false; }\n    typer.value = typer.value.substr(0, from) + update + typer.value.substr(to);\n\n    const drift = where => {\n      if (where > to) {\n        // after the update\n        where = where - (to - from) + update.length;\n      } else if (where > from) {\n        // during the update\n        where = from + update.length;\n      } else {\n        // do nothing, was before\n      }\n      return where;\n    };\n\n    typer.focus();\n    typer.dispatchEvent(new CustomEvent('change'));  // nb. updates from/to (from won't change)\n    // pretend we were like this all along\n    [state.start, state.end] = [typer.selectionStart, typer.selectionEnd] = [drift(start), drift(end)];\n\n    permitNextChange = true;\n    setRange(from, from + update.length);\n    return true;\n  };\n\n  // handle 'modifier' event: apply modifiers to the focus word, if any\n  el.addEventListener('modifier', ev => {\n    const arg = {[ev.detail.type]: ev.detail.code};\n    replaceFocus(value => modifier.modify(value, arg).out || '');\n  });\n\n  // handle 'emoji' event: if there's a current focus word, then replace it with the new emoji \\o/\n  el.addEventListener('emoji', ev => {\n    const emoji = ev.detail.choice;\n    if (!replaceFocus(_ => emoji)) { return; }\n\n    // if this was a prefix match, now it's a word match (the word masks the emoji)\n    el.dataset['word'] = ev.detail.word || el.dataset['prefix'];\n    datasetSafeDelete(el, 'prefix');\n  });\n}\n\nupgrade(typer);\n","\nexport default function build(raw, prefixLength=3, maxSuggestions=10) {\n  const prefixSuggest = {};\n\n  const values = {};\n  raw.forEach(data => {\n    const k = data[0];\n    values[k] = data.slice(1);\n\n    const prefix = k.substr(0, prefixLength);\n    for (let i = 1; i <= prefix.length; ++i) {\n      const part = prefix.substr(0, i);\n      let opts = prefixSuggest[part];\n      if (!opts) {\n        opts = prefixSuggest[part] = [];\n      }\n      if (opts.length < maxSuggestions) {\n        opts.push(k);\n      }\n    }\n  });\n\n  return function(typed) {\n    typed = typed.toLowerCase();\n    const rest = typed.substr(prefixLength);\n    let all = prefixSuggest[typed.substr(0, prefixLength)] || [];\n\n    if (rest) {\n      all = all.filter(word => word.substr(prefixLength).startsWith(rest));\n    }\n    all = all.map(word => {\n      return {'name': word, 'options': values[word] || []};\n    });\n\n    return all.length ? all : null;\n  }\n}\n","const api = 'https://us-central1-emojityper.cloudfunctions.net';\n\nimport build from './prefixgen.js';\n\nlet indexed;\ntry {\n  let data = JSON.parse(window.localStorage['popular']);\n  if (data['created'] >= (+new Date - 60 * 60 * 24 * 1000)) {\n    indexed = Promise.resolve(build(data['results']));\n    console.debug('got indexed localStorage');\n  }\n} catch (e) {\n  console.debug('couldn\\'t parse localStorage popular', e);\n}\nif (!indexed) {\n  // if no data or >1day old, refetch\n  const f = window.fetch(api + '/popular').then(out => out.json());\n  f.then(data => {\n    data['created'] = +new Date();\n    window.localStorage['popular'] = JSON.stringify(data);\n  });\n  const local = f.then(v => build(v['results']));\n  if (!indexed) {\n    indexed = local;\n  } else {\n    local.then(() => indexed = local);\n  }\n}\n\nlet requestCallback = function() {};\nlet timeout;  // timeout handler for secondary query\nconst performRequest = (text, prefix) => {\n  window.clearTimeout(timeout);\n  if (!text) {\n    requestCallback(null);\n    return;\n  }\n\n  // TODO: only send extra query if there's not enough results, or the user hits 'more'\n  const localTimeout = window.setTimeout(_ => {\n    let url = api + '/query?query=' + encodeURIComponent(text);\n    if (prefix) {\n      url += '&prefix=true';\n    }\n    // FIXME: don't ever clobber old results: maybe do this under \"more\" or if there's\n    // only very few results?\n    window.fetch(url)\n        .then(out => out.json())\n        .then(out => {\n          const all = out.results.map(arr => ({'name': arr[0], 'options': arr.slice(1)}));\n          send(all);\n        });\n  }, 2000);\n  timeout = localTimeout;\n\n  indexed.then(suggest => {\n    let results = suggest(text);\n    if (!prefix) {\n      results = results.filter(result => result['name'] === text);\n    }\n    send(results);\n  });\n\n  // nb. at end to hoist above 'localTimeout'\n  function send(out) {\n    if (timeout === localTimeout) {\n      requestCallback(out);\n    }\n  }\n};\n\nexport function request(text, prefix) {\n  window.requestAnimationFrame(_ => {\n    performRequest(text, prefix);\n  });\n}\n\nlet pendingSelect = {};\nlet timeoutSelect;\nexport function select(name, emoji) {\n  pendingSelect[name] = emoji;\n\n  window.clearTimeout(timeoutSelect);\n  timeoutSelect = window.setTimeout(_ => {\n    const body = JSON.stringify(pendingSelect);\n    pendingSelect = {};\n\n    // TODO: ugh promises\n    window.fetch(api + '/select', {method: 'POST', body})\n  }, 5 * 1000);\n}\n\nexport function submit(name, emoji) {\n  const body = new FormData();\n  body.append('name', name);\n  body.append('emoji', emoji);\n  return window.fetch(api + '/name', {method: 'POST', mode: 'cors', body});\n}\n\nexport function callback(callback) {\n  requestCallback = callback;\n}\n","\n// suggestion handler\n\nimport * as provider from './lib/provider.js';\nimport * as modifier from './lib/modifier.js';\n\n// nb. this puncutation list is just misc stuff needed by emojimap\nconst invalidLetterRe = /[^\\w:\\.,$%^\\-']+/g;\nconst simplifyWord = word => {\n  if (word) {\n    return word.replace(invalidLetterRe, '').toLowerCase();\n  }\n  return null;\n};\n\n/**\n * @type {Map<string, !HTMLButtonElement> cache of previously displayed buttons\n */\nlet buttonCache = new Map();\n\n/**\n * @param {string} text of button to create\n * @return {!HTMLButtonElement} button either from cache or newly created\n */\nfunction createButton(text) {\n  const candidate = buttonCache.get(text);\n  if (candidate) {\n    return candidate;\n  }\n  const button = document.createElement('button');\n  button.textContent = text;\n  buttonCache.set(text, button);\n  return button;\n}\n\n// button click handler\nchooser.addEventListener('click', ev => {\n  const b = ev.target;\n  if (b.localName !== 'button') {\n    // ignore\n  } else if (b.parentNode.dataset['modifier']) {\n    const value = 'value' in b.dataset ? (+b.dataset['value'] || b.dataset['value']) : null;\n    const detail = {type: b.parentNode.dataset['modifier'], code: value};\n    typer.dispatchEvent(new CustomEvent('modifier', {detail}));\n  } else {\n    const word = b.parentNode.dataset['word'];\n    const detail = {choice: b.textContent, word};\n    typer.dispatchEvent(new CustomEvent('emoji', {detail}));\n    provider.select(word, detail.choice);\n  }\n});\n\n// handle moving down from input\ntyper.addEventListener('keydown', ev => {\n  if (ev.key === 'ArrowDown') {\n    const first = chooser.querySelector('button');\n    first && first.focus();\n  }\n});\n\n// handle keyboard navigation inside chooser\nchooser.addEventListener('keydown', ev => {\n  switch (ev.key) {\n  case 'Escape':\n    typer.focus();\n    break;\n  }\n  if (!ev.key.startsWith('Arrow')) { return; }\n  if (!document.activeElement || !chooser.contains(document.activeElement)) { return; }\n\n  // TODO: memoize value\n  const buttonArray = Array.from(chooser.querySelectorAll('button'));\n  const index = buttonArray.indexOf(document.activeElement);\n  if (index === -1) { return; }\n\n  // handle l/r keys\n  let delta;\n  if (ev.key === 'ArrowLeft') {\n    delta = -1;\n  } else if (ev.key === 'ArrowRight') {\n    delta = +1;\n  }\n  if (delta) {\n    const target = index + delta;\n    if (target >= 0 && target < buttonArray.length) {\n      buttonArray[target].focus();\n    }\n    return;  // done\n  }\n\n  // handle u/d keys\n  if (ev.key === 'ArrowUp') {\n    delta = -1;\n  } else if (ev.key === 'ArrowDown') {\n    delta = +1;\n  } else {\n    return;\n  }\n  const previousRect = document.activeElement.getBoundingClientRect();\n  const best = {dist: Infinity, button: null};\n\n  let targetTop = undefined;\n  let candidate = index;\n  while ((candidate += delta) >= 0 && candidate < buttonArray.length) {\n    const button = buttonArray[candidate];\n    const candidateRect = button.getBoundingClientRect();\n\n    if (previousRect.top === candidateRect.top) { continue; }\n    if (targetTop === undefined) {\n      targetTop = candidateRect.top;\n    }\n    if (candidateRect.top !== targetTop) {\n      break;  // no more good candidates\n    }\n\n    const dist = Math.abs(candidateRect.left - previousRect.left);\n    if (dist < best.dist) {\n      [best.dist, best.button] = [dist, button];\n    }\n  }\n\n  if (best.button) {\n    best.button.focus();\n  } else if (targetTop === undefined && delta < 0) {\n  // if we were at top and going -ve, then return to input\n    typer.focus();\n  }\n});\n\nlet savedResults = null;\nlet query = null;\nconst show = results => {\n  savedResults = results;\n\n  chooser.textContent = '';\n  const canary = document.createElement('span');\n  chooser.appendChild(canary);\n  const updatedButtonCache = new Map();\n\n  // if there's a focus but it's not a prefix (which implies that it's text-only)\n  if (query.focus && !query.prefix) {\n    // TODO: dedup some of this code with the below generators\n    const holderFor = type => {\n      const el = document.createElement('div');\n      el.className = 'options modifier';\n\n      const buttons = document.createElement('div');\n      buttons.className = 'buttons';\n      buttons.dataset['modifier'] = type;\n      el.appendChild(buttons);\n\n      const h4 = document.createElement('h4');\n      h4.textContent = type;\n      el.appendChild(h4);\n\n      chooser.appendChild(el);\n      return buttons;\n    };\n    const createModifierButton = (holder, text, opt_value) => {\n      const button = document.createElement('button');\n      button.textContent = text;\n      if (opt_value) {\n        button.dataset['value'] = opt_value;\n      }\n      holder.appendChild(button);\n    };\n\n    const out = modifier.modify(query.focus);\n\n    if (out.gender.single || out.gender.double) {\n      const genderHolder = holderFor('gender');\n      out.gender.neutral && createModifierButton(genderHolder, '\\u{2014}');\n      out.gender.single && createModifierButton(genderHolder, '\\u{2640}', 'f');\n      out.gender.double && createModifierButton(genderHolder, '\\u{2640}\\u{2642}', 'fm');\n      out.gender.single && createModifierButton(genderHolder, '\\u{2642}', 'm');\n      out.gender.double && createModifierButton(genderHolder, '\\u{2642}\\u{2640}', 'mf');\n    }\n\n    if (out.diversity) {\n      const diversityHolder = holderFor('diversity');\n      createModifierButton(diversityHolder, '\\u{2014}');\n      for (let i = 0x1f3fb; i <= 0x1f3ff; ++i) {\n        createModifierButton(diversityHolder, String.fromCodePoint(i), i);\n      }\n    }\n  }\n\n  // create buttons and headings for all options; immediately re-add previously cached buttons\n  const replacement = document.createDocumentFragment();\n  const holders = {};\n  results && results.forEach(result => {\n    const name = result['name'];\n\n    const el = document.createElement('div');\n    el.className = 'options';\n\n    const buttons = document.createElement('div');\n    buttons.className = 'buttons';\n    buttons.dataset['word'] = name;\n    el.appendChild(buttons);\n\n    const h4 = document.createElement('h4');\n    h4.textContent = name;\n    el.appendChild(h4);\n\n    replacement.appendChild(el);\n    holders[name] = buttons;\n\n    // do a quick pass on already available buttons\n    result['pending'] = result['options'].filter(option => {\n      const button = buttonCache.get(option);\n      if (!button) {\n        return true;  // we want to redraw this later\n      } else if (!updatedButtonCache.has(option)) {\n        // don't show the same emoji button twice\n        buttons.appendChild(button);\n        updatedButtonCache.set(option, button);\n      }\n      return false;\n    });\n  });\n  buttonCache = updatedButtonCache;\n  chooser.appendChild(replacement);\n\n  // async helper function for adding emoji over multiple frames (via requestIdleCallback).\n  if (!results) { return; }\n  const p = (async function() {\n    let idle = null;\n\n    for (let i = 0, result; result = results[i]; ++i) {\n      const options = result['pending'];\n      for (let j = 0, option; option = options[j]; ++j) {\n        if (!idle || idle.timeRemaining() <= 0) {\n          const p = new Promise(resolve => window.requestIdleCallback(o => resolve(o)));\n          idle = await p;\n          if (!canary.parentNode) { return; }\n        }\n        if (!buttonCache.has(option) && modifier.isExpectedLength(option)) {\n          // TODO: If a user has allowed it, render all emojis (even invalid) anyway.\n          const holder = holders[result['name']];\n          holder.appendChild(createButton(option));\n        }\n      };\n    };\n  }());\n  p.catch(e => console.warn('couldn\\'t render emoji', e));\n};\n\n// set global callback for show\nprovider.callback(show);\n\n// handler for a prefix search\ntyper.addEventListener('query', ev => {\n  query = ev.detail;\n  provider.request(query.text, query.prefix);\n});\n\n// request an autocomplete, the user has just kept typing\ntyper.addEventListener('request', ev => {\n  const word = simplifyWord(ev.detail);\n  let choice = null;\n\n  (savedResults || []).some(result => {\n    if (result['name'] !== word) { return false; }\n    choice = result.options[0];\n    return true;\n  });\n\n  if (choice) {\n    const detail = {choice, word};\n    typer.dispatchEvent(new CustomEvent('emoji', {detail}));\n  }\n});\n","\n/**\n * @fileoverview Polyfills needed for modern browsers, even those supporting ES6 modules.\n */\n\nif (!window.requestIdleCallback) {\n  // TODO: this is a pretty terrible requestIdleCallback\n  window.requestIdleCallback = callback => {\n    const start = performance.now();\n    const fn = callback.bind(null, {\n      didTimeout: false,\n      timeRemaining: () => Math.max(0, 50 - (performance.now() - start)),\n    });\n    return window.setTimeout(fn, 1);\n  };\n\n  window.cancelIdleCallback = id => window.clearTimeout(id);\n}\n\n","\nconst all = Array.prototype.slice.call(buttons.querySelectorAll('button'));\n\nconst handler = ev => {\n  const text = (ev ? ev.detail : typer.value).trim();\n  const hasValue = Boolean(text);\n  document.body.classList.toggle('has-value', hasValue);\n  all.forEach(button => button.disabled = !hasValue);\n};\n\ntyper.addEventListener('value', handler);\nhandler();\n\n// copy handler\n(function(button, input) {\n  let timeout;\n  const defaultText = button.textContent;\n  const spaceRe = /\\s*/;\n\n  const copy = _ => {\n    const [start, end] = [input.selectionStart, input.selectionEnd];\n\n    // find start/end of content (trim, but find positions)\n    let left = 0;\n    let right = input.value.length;\n    if (input.selectionStart !== input.selectionEnd) {\n      left = input.selectionStart;\n      right = input.selectionEnd;\n    }\n    left += spaceRe.exec(input.value.substr(left))[0].length;\n    right = left + input.value.substr(left, right - left).trim().length;\n    if (right <= left) { return false; }\n\n    input.focus();\n    input.selectionStart = left;\n    input.selectionEnd = right;\n\n    let ok = false;\n    try {\n      ok = document.execCommand('copy');\n    } catch(e) {\n      console.warn('could not copy', e);\n      ok = false;\n    }\n    // restore previous selection\n    [input.selectionStart, input.selectionEnd] = [start, end];\n\n    if (!ok) { return true; }\n    console.info('copied', input.value.substr(left, right));\n\n    // show message\n    button.textContent = button.dataset.copied;\n    window.clearTimeout(timeout);\n    timeout = window.setTimeout(ev => {\n      button.textContent = defaultText;\n    }, 500);\n  };\n\n  input.addEventListener('keydown', ev => {\n    if (ev.key == 'Enter') {\n      button.click();\n      input.focus();\n    }\n  });\n  button.addEventListener('click', ev => {\n    copy();\n    button.focus();\n  });\n}(copy, typer));\n\n","\nimport * as provider from './lib/provider.js';\n\n// advanced handler\n(function(input, advanced) {\n  const form = advanced.querySelector('form');\n  const namer = form.querySelector('input');\n  const button = form.querySelector('button');\n\n  let focus = '';\n\n  input.addEventListener('query', ev => {\n    const query = ev.detail;\n    const selection = (query.text === null && query.focus !== undefined);\n    focus = query.focus;\n    advanced.hidden = !selection;\n    if (advanced.hidden) {\n      namer.value = '';\n    }\n  });\n\n  const handler = ev => {\n    button.disabled = !namer.value;\n  };\n  'input change'.split(/\\s+/).forEach(type => namer.addEventListener(type, handler));\n\n  form.addEventListener('submit', ev => {\n    ev.preventDefault();\n\n    form.classList.add('pending');\n    namer.disabled = true;\n    button.disabled = true;\n\n    const cleanup = _ => {\n      form.classList.remove('pending');\n      namer.disabled = false;\n      namer.value = '';\n      namer.dispatchEvent(new CustomEvent('change'));\n    };\n\n    const p = provider.submit(namer.value, focus).then(_ => {\n      button.classList.add('success');\n      return false;\n    }).catch(err => {\n      button.classList.add('failure');\n      console.warn('failed to submit emoji', err)\n      return true;\n    }).then(cleanup);\n\n    p.then(_ => new Promise((resolve, reject) => window.setTimeout(resolve, 2000))).then(_ => {\n      button.className = '';\n    });\n  });\n\n}(typer, advanced));\n"]}