function isPointGender(e){return 9792===e||9794===e}function isPersonGender(e){return 128104===e||128105===e}function isFamilyMember(e){return 128118===e||128102===e||128103===e}function isVariationSelector(e){return e>=65024&&e<=65039||e>=917760&&e<=917999}function isDiversitySelector(e){return e>=127995&&e<=127999}function isFlagPoint(e){return e>=127462&&e<=127487}function unlikelyModifierBase(e){return e<9757||isPointGender(e)||isVariationSelector(e)||isDiversitySelector(e)||isFlagPoint(e)}function jsdecode(e){const t=e.length,n=[];for(let o=0;o<t;){const i=e.charCodeAt(o++)||0;if(i<55296||i>56319||o===t);else{const t=e.charCodeAt(o)||0;if(56320==(64512&t)){++o,n.push(65536+(1023&t)+((1023&i)<<10));continue}}n.push(i)}return n}function splitEmoji(e){if(!e.length)return[];let t=[{point:e[0],suffix:0}];const n=[t];for(let o=1;o<e.length;++o){const i=e[o];if(isFlagPoint(t[t.length-1].point));else{if(isDiversitySelector(i)||isVariationSelector(i)){t[t.length-1].suffix=i;continue}if(8205===i){const n=e[++o];n&&t.push({point:n,suffix:0});continue}}t=[{point:i,suffix:0}],n.push(t)}return n}function modify(e,t){const n={diversity:!1,gender:{single:!1,double:!1,neutral:!1}},o=splitEmoji(jsdecode(e)),i=t?[]:null;if(o.some((e,t)=>{const o=e[0].point;let s=0;let r=!1;e.forEach(e=>{const t=e.point;if(isPointGender(t))n.gender.single=!0,n.gender.neutral=!0;else if(isPersonGender(t))n.gender.single=!0,++s>=2&&(n.gender.double=!0);else if(isFamilyMember(t)&&s)r=!0;else{const e=genderFlip(t);e&&(n.gender.single|=e.single,n.gender.neutral|=e.neutral)}});const c=s?isPersonGender(o)&&1===s&&!r:void 0;c&&(n.diversity=basicDiversity);i&&(i[t]=c);if((n.diversity||!basicDiversity)&&n.gender.neutral)return!i&&n.gender.single&&n.gender.double;if(!1===c||unlikelyModifierBase(o))return;const a=String.fromCodePoint(o);basicDiversity&&!n.diversity&&isSingle(a+"\u{1f3fb}")&&(n.diversity=!0);!n.gender.neutral&&isSingle(a+"\u200d\u2640\ufe0f")&&(n.gender.neutral=!0,n.gender.single=!0)}),!t)return n;const s=function(){const e=t.gender||"";let n,o;return(t,i,s)=>{void 0===n||t!==n?(n=t,o=0):++o;const r=e?e[o%e.length]:"";const c=i||0;if(isPersonGender(c))return r?"m"===r?128104:128105:c;if(!c||isPointGender(c))return r?"m"===r?9794:9792:0;if(s){const e=genderFlip(c);if(e){if(!r&&e.neutral)return e.points.n;if(r&&e.single)return"m"===r?e.points.m:e.points.f}}--o;return c}}(),r=o.map((e,n)=>{const o=[];const r=i[n];const c=e[0].point;if(void 0!==t.gender){const t=void 0===r;if(e.forEach(e=>e.point=s(o,e.point,t)),void 0===r&&1===e.length&&!isPointGender(c)){const t=s(o);t&&isSingle(String.fromCodePoint(c)+"\u200d\u2640\ufe0f")&&e.push({suffix:65039,point:t})}}void 0!==t.diversity&&e.forEach((e,n)=>{isDiversitySelector(e.suffix)?e.suffix=t.diversity:0===n&&basicDiversity&&!1!==r&&(r||isSingle(String.fromCodePoint(c)+"\u{1f3fb}"))&&(e.suffix=t.diversity)});e.forEach(e=>{e.point&&(o.length&&o.push(8205),o.push(e.point),e.suffix&&o.push(e.suffix))});return o}).reduce((e,t)=>e.concat(t),[]);return n.out=String.fromCodePoint(...r),n}function datasetSafeDelete(e,...t){const n=e.dataset;for(let o of t)o in n&&delete n[o]}function upgrade(e){const t=e=>e<5e3&&32!=e,n=document.createElement("div");n.className="overflow-helper",e.parentNode.insertBefore(n,e);const o=document.createElement("div");o.className="underline",n.appendChild(o);const i=document.createElement("div");i.className="sizer",n.appendChild(i),"complete"!==document.readyState&&(o.classList.add("loading"),window.addEventListener("load",e=>{s();o.classList.remove("loading")}));const s=t=>{if(void 0===e.dataset.from)return o.hidden=!0,!1;const[n,s]=[+e.dataset.from,+e.dataset.to];i.textContent=e.value.substr(0,n);const r=n?i.getBoundingClientRect().width:15;i.textContent=e.value.substr(n,s-n);const c=i.getBoundingClientRect().width-15;c<0&&!document.getElementById("less")&&console.warn("invalid sizer width",c,"for text",i.textContent);o.hidden=c<=0;o.style.left=r+"px";o.style.width=c+"px";o.style.transform="translateX(-"+e.scrollLeft+"px)"},r=(t,n)=>{if(t>=n)return datasetSafeDelete(e,"from","to","prefix","word","focus"),o.hidden=!0,!1;[e.dataset.from,e.dataset.to]=[t,n];e.dataset.focus=e.value.substr(t,n-t);s();return!0},c=e.value.length,a={start:c,end:c,value:void 0},u=n=>{if(!1!==n&&e.selectionStart===a.start&&e.selectionEnd===a.end&&e.value===a.value)return!0;[a.start,a.end]=[e.selectionStart,e.selectionEnd];a.value!==e.value&&(e.dispatchEvent(new CustomEvent("value",{detail:e.value})),a.value=e.value);if(a.start!==a.end)return datasetSafeDelete(e,"prefix","word"),r(a.start,a.end),o.classList.add("range"),e.classList.add("range"),!1;o.classList.remove("range");e.classList.remove("range");let i=a.start;let s=a.start;const c=!e.value.substr(a.end).trim();const u=c||!t(e.value.charCodeAt(a.end));if(u){for(;s>0&&32===e.value.charCodeAt(s-1);--s);s<i&&(i=s)}for(;i>0&&t(e.value.charCodeAt(i-1));--i);for(;s<e.value.length&&t(e.value.charCodeAt(s));++s);if(i>=s&&u&&n)return;r(i,s)&&(e.dataset.focus=e.dataset.prefix=e.value.substr(i,s-i),datasetSafeDelete(e,"word"))},d=(t,n)=>{t.has("focus")&&a.start===a.end&&([e.selectionStart,e.selectionEnd]=[a.start,a.end]);if(u(n))return;let o=e.dataset.prefix||e.dataset.word||null;const i={text:o,prefix:"prefix"in e.dataset,focus:e.dataset.focus};e.dispatchEvent(new CustomEvent("query",{detail:i}))};let l;!function(){let t,n=new Set;const o=e=>{t||(l=void 0,n.clear(),t=window.requestAnimationFrame(e=>{t=null;d(n,l)}));e&&n.add(e.type)};"change keydown keypress focus click mousedown select input".split(/\s+/).forEach(t=>e.addEventListener(t,o)),o(),e.addEventListener("mousemove",e=>{e.which&&o()})}(),e.addEventListener("blur",t=>{e.selectionStart===a.start&&e.selectionStart===a.end||([e.selectionStart,e.selectionEnd]=[a.start,a.end])}),e.addEventListener("keydown",t=>{switch(t.key){case"Escape":l=!1;break;case" ":e.dataset.prefix&&e.selectionStart===+e.dataset.to&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),function(){let t;const n=e=>{t||(t=window.requestAnimationFrame(e=>{t=null;s()}))};window.addEventListener("resize",n),e.addEventListener("wheel",n,{passive:!0})}();const f=t=>{if(void 0===e.dataset.from||void 0===e.dataset.to)return!1;const[n,o]=[+e.dataset.from,+e.dataset.to];const i=e.value.substr(n,o-n);let[s,c]=[typer.selectionStart,typer.selectionEnd];const u=t(i);if(null==u)return!1;typer.value=typer.value.substr(0,n)+u+typer.value.substr(o);const d=e=>{e>o?e=e-(o-n)+u.length:e>n&&(e=n+u.length);return e};typer.focus();typer.dispatchEvent(new CustomEvent("change"));[a.start,a.end]=[typer.selectionStart,typer.selectionEnd]=[d(s),d(c)];l=!0;r(n,n+u.length);return!0};e.addEventListener("modifier",e=>{const t={[e.detail.type]:e.detail.code};f(e=>modify(e,t).out||"")}),e.addEventListener("emoji",t=>{const n=t.detail.choice;if(!f(e=>n))return;e.dataset.word=t.detail.word||e.dataset.prefix;datasetSafeDelete(e,"prefix")})}function request(e,t){window.requestAnimationFrame(n=>{performRequest(e,t)})}function select(e,t){pendingSelect[e]=t,window.clearTimeout(timeoutSelect),timeoutSelect=window.setTimeout(e=>{const t=JSON.stringify(pendingSelect);pendingSelect={};window.fetch(api+"/select",{method:"POST",body:t})},5e3)}function submit(e,t){const n=new FormData;return n.append("name",e),n.append("emoji",t),window.fetch(api+"/name",{method:"POST",mode:"cors",body:n})}function callback(e){requestCallback=e}function createButton(e){const t=buttonCache.get(e);if(t)return t;const n=document.createElement("button");return n.textContent=e,buttonCache.set(e,n),n}window.requestIdleCallback||(window.requestIdleCallback=(e=>{const t=performance.now();const n=e.bind(null,{didTimeout:!1,timeRemaining:()=>Math.max(0,50-(performance.now()-t))});return window.setTimeout(n,1)}),window.cancelIdleCallback=(e=>window.clearTimeout(e)));const all=Array.prototype.slice.call(buttons.querySelectorAll("button")),handler=e=>{const t=(e?e.detail:typer.value).trim();const n=Boolean(t);document.body.classList.toggle("has-value",n);all.forEach(e=>e.disabled=!n)};typer.addEventListener("value",handler),handler(),function(e,t){let n;const o=e.textContent,i=/\s*/,s=s=>{const[r,c]=[t.selectionStart,t.selectionEnd];let a=0;let u=t.value.length;t.selectionStart!==t.selectionEnd&&(a=t.selectionStart,u=t.selectionEnd);a+=i.exec(t.value.substr(a))[0].length;u=a+t.value.substr(a,u-a).trim().length;if(u<=a)return!1;t.focus();t.selectionStart=a;t.selectionEnd=u;let d=!1;try{d=document.execCommand("copy")}catch(e){console.warn("could not copy",e),d=!1}[t.selectionStart,t.selectionEnd]=[r,c];if(!d)return!0;console.info("copied",t.value.substr(a,u));e.textContent=e.dataset.copied;window.clearTimeout(n);n=window.setTimeout(t=>{e.textContent=o},500)};t.addEventListener("keydown",n=>{"Enter"==n.key&&(e.click(),t.focus())}),e.addEventListener("click",t=>{s();e.focus()})}(copy,typer);const measureText=function(){const e=document.createElement("canvas").getContext("2d");e.font="1px monospace";let t={},n=0;return o=>{let i=t[o];void 0===i&&(t[o]=i=e.measureText(o).width,++n>4e3&&(t={},n=0));return i}}(),fixedWidthEmoji=Boolean(/Mac|Android|iP(hone|od|ad)/),isSingle=function(){if(fixedWidthEmoji){const e=measureText("\u{1f602}");return t=>measureText(t)===e}const e=context.measureText("\u{ffffd}").width;return t=>{const n=measureText(t);return n!==e&&n<2*e}}(),isExpectedLength=function(){if(fixedWidthEmoji){const e=measureText("\u{1f602}");return t=>{const n=jsdecode(t);const o=splitEmoji(n);const i=o.reduce((e,t)=>e+=isFlagPoint(t[0].point)?1:0,0);const s=o.length-Math.ceil(i/2);const r=measureText(t)/e;if(Math.floor(r)!==r)return!1;return r<=s}}context.measureText("\u{ffffd}").width;return e=>{const t=jsdecode(e);const n=splitEmoji(t);for(let o=0;o<n.length;++o){const e=n[o];if(isFlagPoint(e[0].point)){if(o===n.length-1||!isFlagPoint(e[o+1].point))return!1;const t=String.fromCodePoint(...e[o].point,e[o+1].point);if(!isSingle(t))return!1;++o;continue}const t=String.fromCodePoint(...e.map(e=>e.point));if(!isSingle(t))return!1}return!0}}(),basicDiversity=measureText("\u{1f468}\u{1f3fb}")===measureText("\u{1f468}"),genderFlip=function(){const e=[129334,127877,0,128131,128378,0,128112,129333,0,128103,128102,0,128117,128116,129491,128109,128108,0,128120,129332,0],t=new Map;for(let n=0;n<e.length;n+=3){const o={points:{f:e[n],m:e[n+1],n:e[n+2]}};for(let i=0;i<3;++i){const s=e[n+i];if(s){if(t.has(s))throw new Error("duplicate in gender list: "+s);t.set(s,o)}}}return e=>{const n=t.get(e)||null;n&&void 0===n.single&&(n.single=isSingle(String.fromCodePoint(n.points.f))&&isSingle(String.fromCodePoint(n.points.m)),n.neutral=n.points.n&&isSingle(String.fromCodePoint(n.points.n)));return n}}();upgrade(typer);const api="https://emojityper.appspot.com",data=window.fetch(api+"/popular").then(e=>e.json());let indexed=data.then(e=>{const t={};for(let n in e){const e=n.substr(0,3);for(let o=1;o<=e.length;++o){const i=e.substr(0,o);let s=t[i];s||(s=t[i]=[]),s.length<10&&s.push(n)}}return function(n){const o=(n=n.toLowerCase()).substr(3);let i=t[n.substr(0,3)]||[];return o&&(i=i.filter(e=>e.substr(3).startsWith(o))),i=i.map(t=>({name:t,options:e[t]||[]})),i.length?i:null}}),requestCallback=function(){},timeout;const performRequest=(e,t)=>{function n(e){timeout===o&&requestCallback(e)}window.clearTimeout(timeout);if(!e)return void requestCallback(null);const o=window.setTimeout(o=>{const i=new FormData;i.append("q",e);i.append("prefix",t);window.fetch(api+"/query",{method:"POST",data:i}).then(e=>e.json()).then(n)},2e3);timeout=o;indexed.then(o=>{let i=o(e);t||(i=i.filter(t=>t.name===e));n(i)})};let pendingSelect={},timeoutSelect;const invalidLetterRe=/[^\w:\.,$%^\-']+/g,simplifyWord=e=>{if(e)return e.replace(invalidLetterRe,"").toLowerCase();return null};let buttonCache=new Map;chooser.addEventListener("click",e=>{const t=e.target;if("button"!==t.localName);else if(t.parentNode.dataset.modifier){const e="value"in t.dataset?+t.dataset.value||t.dataset.value:null,n={type:t.parentNode.dataset.modifier,code:e};typer.dispatchEvent(new CustomEvent("modifier",{detail:n}))}else{const e=t.parentNode.dataset.word,n={choice:t.textContent,word:e};typer.dispatchEvent(new CustomEvent("emoji",{detail:n})),select(e,n.choice)}}),typer.addEventListener("keydown",e=>{if("ArrowDown"===e.key){const e=chooser.querySelector("button");e&&e.focus()}}),chooser.addEventListener("keydown",e=>{switch(e.key){case"Escape":typer.focus()}if(!e.key.startsWith("Arrow"))return;if(!document.activeElement||!chooser.contains(document.activeElement))return;const t=Array.from(chooser.querySelectorAll("button"));const n=t.indexOf(document.activeElement);if(-1===n)return;let o;"ArrowLeft"===e.key?o=-1:"ArrowRight"===e.key&&(o=1);if(o){const e=n+o;return void(e>=0&&e<t.length&&t[e].focus())}if("ArrowUp"===e.key)o=-1;else{if("ArrowDown"!==e.key)return;o=1}const i=document.activeElement.getBoundingClientRect();const s={dist:1/0,button:null};let r=void 0;let c=n;for(;(c+=o)>=0&&c<t.length;){const e=t[c],n=e.getBoundingClientRect();if(i.top===n.top)continue;if(void 0===r&&(r=n.top),n.top!==r)break;const o=Math.abs(n.left-i.left);o<s.dist&&([s.dist,s.button]=[o,e])}s.button?s.button.focus():void 0===r&&o<0&&typer.focus()});let savedResults=null,query=null;const show=e=>{savedResults=e;chooser.textContent="";const t=document.createElement("span");chooser.appendChild(t);const n=new Map;if(query.focus&&!query.prefix){const e=e=>{const t=document.createElement("div");t.className="options modifier";const n=document.createElement("div");n.className="buttons";n.dataset.modifier=e;t.appendChild(n);const o=document.createElement("h4");o.textContent=e;t.appendChild(o);chooser.appendChild(t);return n},t=(e,t,n)=>{const o=document.createElement("button");o.textContent=t;n&&(o.dataset.value=n);e.appendChild(o)},n=modify(query.focus);if(n.gender.single||n.gender.double){const o=e("gender");n.gender.neutral&&t(o,"\u2014"),n.gender.single&&t(o,"\u2640","f"),n.gender.double&&t(o,"\u2640\u2642","fm"),n.gender.single&&t(o,"\u2642","m"),n.gender.double&&t(o,"\u2642\u2640","mf")}if(n.diversity){const n=e("diversity");t(n,"\u2014");for(let e=127995;e<=127999;++e)t(n,String.fromCodePoint(e),e)}}const o=document.createDocumentFragment();const i={};e&&e.forEach(e=>{const t=e.name;const s=document.createElement("div");s.className="options";const r=document.createElement("div");r.className="buttons";r.dataset.word=t;s.appendChild(r);const c=document.createElement("h4");c.textContent=t;s.appendChild(c);o.appendChild(s);i[t]=r;e.pending=e.options.filter(e=>{const t=buttonCache.get(e);if(!t)return!0;n.has(e)||(r.appendChild(t),n.set(e,t));return!1})});buttonCache=n;chooser.appendChild(o);if(!e)return;const s=async function(){let n=null;for(let o,s=0;o=e[s];++s){const e=o.pending;for(let s,r=0;s=e[r];++r){if(!n||n.timeRemaining()<=0){const e=new Promise(e=>window.requestIdleCallback(t=>e(t)));if(n=await e,!t.parentNode)return}if(!buttonCache.has(s)&&isExpectedLength(s)){const e=i[o.name];e.appendChild(createButton(s))}}}}();s.catch(e=>console.warn("couldn't render emoji",e))};callback(show),typer.addEventListener("query",e=>{query=e.detail;request(query.text,query.prefix)}),typer.addEventListener("request",e=>{const t=simplifyWord(e.detail);let n=null;(savedResults||[]).some(e=>{if(e.name!==t)return!1;n=e.options[0];return!0});if(n){const e={choice:n,word:t};typer.dispatchEvent(new CustomEvent("emoji",{detail:e}))}}),function(e,t){const n=t.querySelector("form"),o=n.querySelector("input"),i=n.querySelector("button");let s="";e.addEventListener("query",e=>{const n=e.detail;const i=null===n.text&&void 0!==n.focus;s=n.focus;t.hidden=!i;t.hidden&&(o.value="")});const r=e=>{i.disabled=!o.value};"input change".split(/\s+/).forEach(e=>o.addEventListener(e,r)),n.addEventListener("submit",e=>{e.preventDefault();n.classList.add("pending");o.disabled=!0;i.disabled=!0;const t=e=>{n.classList.remove("pending");o.disabled=!1;o.value="";o.dispatchEvent(new CustomEvent("change"))};const r=submit(o.value,s).then(e=>{i.classList.add("success");return!1}).catch(e=>{i.classList.add("failure");console.warn("failed to submit emoji",e);return!0}).then(t);r.then(e=>new Promise((e,t)=>window.setTimeout(e,2e3))).then(e=>{i.className=""})})}(typer,advanced);

//# sourceMappingURL=bundle.js.map
