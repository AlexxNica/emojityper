function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function isPointGender(e){return 9792===e||9794===e}function isPersonGender(e){return 128104===e||128105===e}function isFamilyMember(e){return 128118===e||128102===e||128103===e}function isVariationSelector(e){return e>=65024&&e<=65039||e>=917760&&e<=917999}function isDiversitySelector(e){return e>=127995&&e<=127999}function isFlagPoint(e){return e>=127462&&e<=127487}function unlikelyModifierBase(e){return e<9757||isPointGender(e)||isVariationSelector(e)||isDiversitySelector(e)||isFlagPoint(e)}function jsdecode(e){for(var t=e.length,n=[],r=0;r<t;){var i=e.charCodeAt(r++)||0;if(i<55296||i>56319||r===t);else{var o=e.charCodeAt(r)||0;if(56320==(64512&o)){++r,n.push(65536+(1023&o)+((1023&i)<<10));continue}}n.push(i)}return n}function splitEmoji(e){if(!e.length)return[];for(var t=[{point:e[0],suffix:0}],n=[t],r=1;r<e.length;++r){var i=e[r];if(isFlagPoint(t[t.length-1].point));else{if(isDiversitySelector(i)||isVariationSelector(i)){t[t.length-1].suffix=i;continue}if(8205===i){var o=e[++r];o&&t.push({point:o,suffix:0});continue}}t=[{point:i,suffix:0}],n.push(t)}return n}function modify(e,t){var n={diversity:!1,gender:{single:!1,double:!1,neutral:!1}},r=splitEmoji(jsdecode(e)),i=t?[]:null;if(r.some(function(e,t){var r=e[0].point,o=0,a=!1;e.forEach(function(e){var t=e.point;if(isPointGender(t))n.gender.single=!0,n.gender.neutral=!0;else if(isPersonGender(t))n.gender.single=!0,++o>=2&&(n.gender.double=!0);else if(isFamilyMember(t)&&o)a=!0;else{var r=genderFlip(t);r&&(n.gender.single|=r.single,n.gender.neutral|=r.neutral)}});var s=o?isPersonGender(r)&&1===o&&!a:void 0;if(s&&(n.diversity=basicDiversity),i&&(i[t]=s),(n.diversity||!basicDiversity)&&n.gender.neutral)return!i&&n.gender.single&&n.gender.double;if(!1!==s&&!unlikelyModifierBase(r)){var u=String.fromCodePoint(r);basicDiversity&&!n.diversity&&isSingle(u+"\u{1f3fb}")&&(n.diversity=!0),!n.gender.neutral&&isSingle(u+"\u200d\u2640\ufe0f")&&(n.gender.neutral=!0,n.gender.single=!0)}}),!t)return n;var o=function(){var e=t.gender||"",n=void 0,r=void 0;return function(t,i,o){void 0===n||t!==n?(n=t,r=0):++r;var a=e?e[r%e.length]:"",s=i||0;if(isPersonGender(s))return a?"m"===a?128104:128105:s;if(!s||isPointGender(s))return a?"m"===a?9794:9792:0;if(o){var u=genderFlip(s);if(u){if(!a&&u.neutral)return u.points.n;if(a&&u.single)return"m"===a?u.points.m:u.points.f}}return--r,s}}(),a=r.map(function(e,n){var r=[],a=i[n],s=e[0].point;if(void 0!==t.gender){var u=void 0===a;if(e.forEach(function(e){return e.point=o(r,e.point,u)}),void 0===a&&1===e.length&&!isPointGender(s)){var d=o(r);d&&isSingle(String.fromCodePoint(s)+"\u200d\u2640\ufe0f")&&e.push({suffix:65039,point:d})}}return void 0!==t.diversity&&e.forEach(function(e,n){isDiversitySelector(e.suffix)?e.suffix=t.diversity:0===n&&basicDiversity&&!1!==a&&(a||isSingle(String.fromCodePoint(s)+"\u{1f3fb}"))&&(e.suffix=t.diversity)}),e.forEach(function(e){e.point&&(r.length&&r.push(8205),r.push(e.point),e.suffix&&r.push(e.suffix))}),r}).reduce(function(e,t){return e.concat(t)},[]);return n.out=String.fromCodePoint.apply(String,_toConsumableArray(a)),n}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function upgrade(e){var t=function(e){return e<5e3&&32!=e},n=document.createElement("div");n.className="overflow-helper",e.parentNode.insertBefore(n,e);var r=document.createElement("div");r.className="underline",n.appendChild(r);var i=document.createElement("div");i.className="sizer",n.appendChild(i),"complete"!==document.readyState&&(r.classList.add("loading"),window.addEventListener("load",function(e){o(),r.classList.remove("loading")}));var o=function(t){if(void 0===e.dataset.from)return r.hidden=!0,!1;var n=+e.dataset.from,o=+e.dataset.to;i.textContent=e.value.substr(0,n);var a=n?i.getBoundingClientRect().width:15;i.textContent=e.value.substr(n,o-n);var s=i.getBoundingClientRect().width-15;r.hidden=!1,r.style.left=a+"px",r.style.width=s+"px",r.style.transform="translateX(-"+e.scrollLeft+"px)"},a=function(t,n){if(t>=n)return["from","to","prefix","word","focus"].forEach(function(t){return delete e.dataset[t]}),r.hidden=!0,!1;var i=[t,n];return e.dataset.from=i[0],e.dataset.to=i[1],e.dataset.focus=e.value.substr(t,n-t),o(),!0},s=e.value.length,u={start:s,end:s,value:void 0},d=function(n){if(!1!==n&&e.selectionStart===u.start&&e.selectionEnd===u.end&&e.value===u.value)return!0;var i=[e.selectionStart,e.selectionEnd];if(u.start=i[0],u.end=i[1],u.value!==e.value&&(e.dispatchEvent(new CustomEvent("value",{detail:e.value})),u.value=e.value),u.start!==u.end)return delete e.dataset.prefix,delete e.dataset.word,a(u.start,u.end),r.classList.add("range"),e.classList.add("range"),!1;r.classList.remove("range"),e.classList.remove("range");var o=u.start,s=u.start,d=!e.value.substr(u.end).trim()||!t(e.value.charCodeAt(u.end));if(d){for(;s>0&&32===e.value.charCodeAt(s-1);--s);s<o&&(o=s)}for(;o>0&&t(e.value.charCodeAt(o-1));--o);for(;s<e.value.length&&t(e.value.charCodeAt(s));++s);o>=s&&d&&n||a(o,s)&&(e.dataset.focus=e.dataset.prefix=e.value.substr(o,s-o),delete e.dataset.word)},l=function(t,n){if(t.has("focus")&&u.start===u.end){var r=[u.start,u.end];e.selectionStart=r[0],e.selectionEnd=r[1]}if(!d(n)){var i={text:e.dataset.prefix||e.dataset.word||null,prefix:"prefix"in e.dataset,focus:e.dataset.focus};e.dispatchEvent(new CustomEvent("query",{detail:i}))}},c=void 0;!function(){var t=void 0,n=new Set,r=function(e){t||(c=void 0,n.clear(),t=window.requestAnimationFrame(function(e){t=null,l(n,c)})),e&&n.add(e.type)};"change keydown keypress focus click mousedown select input".split(/\s+/).forEach(function(t){return e.addEventListener(t,r)}),r(),e.addEventListener("mousemove",function(e){e.which&&r()})}(),e.addEventListener("blur",function(t){if(e.selectionStart!==u.start||e.selectionStart!==u.end){var n=[u.start,u.end];e.selectionStart=n[0],e.selectionEnd=n[1]}}),e.addEventListener("keydown",function(t){switch(t.key){case"Escape":c=!1;break;case" ":e.dataset.prefix&&e.selectionStart===+e.dataset.to&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),function(){var t=void 0,n=function(e){t||(t=window.requestAnimationFrame(function(e){t=null,o()}))};window.addEventListener("resize",n),e.addEventListener("wheel",n,{passive:!0})}();var f=function(t){var n;if(void 0===e.dataset.from||void 0===e.dataset.to)return!1;var r=+e.dataset.from,i=+e.dataset.to,o=e.value.substr(r,i-r),s=[typer.selectionStart,typer.selectionEnd],d=s[0],l=s[1],f=t(o);if(null==f)return!1;typer.value=typer.value.substr(0,r)+f+typer.value.substr(i);var v=function(e){return e>i?e=e-(i-r)+f.length:e>r&&(e=r+f.length),e};typer.focus(),typer.dispatchEvent(new CustomEvent("change"));var p=(n=[v(d),v(l)],typer.selectionStart=n[0],typer.selectionEnd=n[1],n),m=_slicedToArray(p,2);return u.start=m[0],u.end=m[1],c=!0,a(r,r+f.length),!0};e.addEventListener("modifier",function(e){var t=_defineProperty({},e.detail.type,e.detail.code);f(function(e){return modify(e,t).out||""})}),e.addEventListener("emoji",function(t){var n=t.detail.choice;f(function(e){return n})&&(e.dataset.word=t.detail.word||e.dataset.prefix,delete e.dataset.prefix)})}function request(e,t){window.requestAnimationFrame(function(n){performRequest(e,t)})}function submit(e,t){var n=new FormData;return n.append("name",e),n.append("emoji",t),window.fetch(api+"/name",{method:"POST",data:n,mode:"no-cors"})}function callback(e){requestCallback=e}var all=Array.prototype.slice.call(buttons.querySelectorAll("button")),handler=function(e){var t=(e?e.detail:typer.value).trim(),n=Boolean(t);document.body.classList.toggle("has-value",n),all.forEach(function(e){return e.disabled=!n})};typer.addEventListener("value",handler),handler(),function(e,t){var n=void 0,r=e.textContent,i=/\s*/,o=function(o){var a=[t.selectionStart,t.selectionEnd],s=a[0],u=a[1],d=0,l=t.value.length;if(t.selectionStart!==t.selectionEnd&&(d=t.selectionStart,l=t.selectionEnd),d+=i.exec(t.value.substr(d))[0].length,(l=d+t.value.substr(d,l-d).trim().length)<=d)return!1;t.focus(),t.selectionStart=d,t.selectionEnd=l;var c=!1;try{c=document.execCommand("copy")}catch(e){console.warn("could not copy",e),c=!1}var f=[s,u];if(t.selectionStart=f[0],t.selectionEnd=f[1],!c)return!0;console.info("copied",t.value.substr(d,l)),e.textContent=e.dataset.copied,window.clearTimeout(n),n=window.setTimeout(function(t){e.textContent=r},500)};t.addEventListener("keydown",function(n){"Enter"==n.key&&(e.click(),t.focus())}),e.addEventListener("click",function(t){o(),e.focus()})}(copy,typer);var measureText=function(){var e=document.createElement("canvas").getContext("2d");e.font="1px monospace";var t={},n=0;return function(r){var i=t[r];return void 0===i&&(t[r]=i=e.measureText(r).width,++n>4e3&&(t={},n=0)),i}}(),fixedWidthEmoji=Boolean(/Mac|Android|iP(hone|od|ad)/),isSingle=function(){if(fixedWidthEmoji){var e=measureText("\u{1f602}");return function(t){return measureText(t)===e}}var t=context.measureText("\u{ffffd}").width;return function(e){var n=measureText(e);return n!==t&&n<2*t}}(),isExpectedLength=function(){if(fixedWidthEmoji){var e=measureText("\u{1f602}");return function(t){var n=splitEmoji(jsdecode(t)),r=n.reduce(function(e,t){return e+=isFlagPoint(t[0].point)?1:0},0),i=n.length-Math.ceil(r/2),o=measureText(t)/e;return Math.floor(o)===o&&o<=i}}context.measureText("\u{ffffd}").width;return function(e){for(var t=splitEmoji(jsdecode(e)),n=0;n<t.length;++n){var r=t[n];if(isFlagPoint(r[0].point)){if(n===t.length-1||!isFlagPoint(r[n+1].point))return!1;var i=String.fromCodePoint.apply(String,_toConsumableArray(r[n].point).concat([r[n+1].point]));if(!isSingle(i))return!1;++n}else{var o=String.fromCodePoint.apply(String,_toConsumableArray(r.map(function(e){return e.point})));if(!isSingle(o))return!1}}return!0}}(),basicDiversity=measureText("\u{1f468}\u{1f3fb}")===measureText("\u{1f468}"),genderFlip=function(){for(var e=[129334,127877,0,128131,128378,0,128112,129333,0,128103,128102,0,128117,128116,129491,128109,128108,0,128120,129332,0],t=new Map,n=0;n<e.length;n+=3)for(var r={points:{f:e[n],m:e[n+1],n:e[n+2]}},i=0;i<3;++i){var o=e[n+i];if(o){if(t.has(o))throw new Error("duplicate in gender list: "+o);t.set(o,r)}}return function(e){var n=t.get(e)||null;return n&&void 0===n.single&&(n.single=isSingle(String.fromCodePoint(n.points.f))&&isSingle(String.fromCodePoint(n.points.m)),n.neutral=n.points.n&&isSingle(String.fromCodePoint(n.points.n))),n}}(),_slicedToArray=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();upgrade(typer);var api="https://emojityper.appspot.com",data=window.fetch(api+"/popular").then(function(e){return e.json()}),indexed=data.then(function(e){var t={};for(var n in e)for(var r=n.substr(0,3),i=1;i<=r.length;++i){var o=r.substr(0,i),a=t[o];a||(a=t[o]=[]),a.length<10&&a.push(n)}return function(n){var r=(n=n.toLowerCase()).substr(3),i=t[n.substr(0,3)]||[];return r&&(i=i.filter(function(e){return e.substr(3).startsWith(r)})),i=i.map(function(t){return{name:t,options:e[t]||[]}}),i.length?i:null}}),requestCallback=function(){},timeout=void 0,performRequest=function(e,t){function n(e){timeout===r&&requestCallback(e)}if(window.clearTimeout(timeout),e){var r=window.setTimeout(function(r){var i=new FormData;i.append("q",e),i.append("prefix",t),window.fetch(api+"/query",{method:"POST",data:i}).then(function(e){return e.json()}).then(n)},2e3);timeout=r,indexed.then(function(r){var i=r(e);t||(i=i.filter(function(t){return t.name===e})),n(i)})}else requestCallback(null)};!function(e,t){var n=/[^\w:\.,$%^\-']+/g,r=function(e){return e?e.replace(n,"").toLowerCase():null},i=[];t.addEventListener("click",function(t){var n=t.target;if("button"!==n.localName);else if(n.dataset.modifier){var r="value"in n.dataset?+n.dataset.value||n.dataset.value:null,i={type:n.dataset.modifier,code:r};e.dispatchEvent(new CustomEvent("modifier",{detail:i}))}else{var o={choice:n.textContent,word:n.dataset.word};e.dispatchEvent(new CustomEvent("emoji",{detail:o}))}}),e.addEventListener("keydown",function(e){if("ArrowDown"===e.key){var n=t.querySelector("button");n&&n.focus()}}),t.addEventListener("keydown",function(t){switch(t.key){case"Escape":e.focus()}if(t.key.startsWith("Arrow")){var n=i.indexOf(document.activeElement);if(-1!==n){var r=void 0;if("ArrowLeft"===t.key?r=-1:"ArrowRight"===t.key&&(r=1),r){var o=n+r;o>=0&&o<i.length&&i[o].focus()}else{if("ArrowUp"===t.key)r=-1;else{if("ArrowDown"!==t.key)return;r=1}for(var a=document.activeElement.getBoundingClientRect(),s={dist:1/0,button:null},u=void 0,d=n;(d+=r)>=0&&d<i.length;){var l=i[d],c=l.getBoundingClientRect();if(a.top!==c.top){if(void 0===u&&(u=c.top),c.top!==u)break;var f=Math.abs(c.left-a.left);if(f<s.dist){var v=[f,l];s.dist=v[0],s.button=v[1]}}}s.button?s.button.focus():void 0===u&&r<0&&e.focus()}}}});var o=null,a=null;callback(function(e){t.textContent="",i.length=0,o=e;var n=function(e,n){var r=document.createElement("div");r.className="options",n&&r.classList.add(n);var i=document.createElement("h4");i.textContent=e,r.appendChild(i);var o=document.createElement("div");return o.className="buttons",r.appendChild(o),t.appendChild(r),o},r=function(e,t){var n=document.createElement("button");return n.textContent=t,e.appendChild(n),i.push(n),n};if(a.focus&&!a.prefix){var s={},u=function(e,t,i){var o=s[e];o||(s[e]=o=n(e,"modifier"));var a=r(o,t);a.dataset.modifier=e,i&&(a.dataset.value=i)},d=modify(a.focus);if(d.gender.neutral&&u("gender","\u2014"),d.gender.single&&u("gender","\u2640","f"),d.gender.double&&u("gender","\u2640\u2642","fm"),d.gender.single&&u("gender","\u2642","m"),d.gender.double&&u("gender","\u2642\u2640","mf"),d.diversity){u("diversity","\u2014");for(var l=127995;l<=127999;++l)u("diversity",String.fromCodePoint(l),l)}}(e||[]).forEach(function(e){var t=e.name,i=null;e.options.forEach(function(e){isExpectedLength(e)&&(i||(i=n(t)),r(i,e).dataset.word=t)})}),document.body.classList.toggle("has-chooser",i.length>0)}),e.addEventListener("query",function(e){request((a=e.detail).text,a.prefix)}),e.addEventListener("request",function(t){var n=r(t.detail),i=null;if((o||[]).some(function(e){return e.name===n&&(i=e.options[0],!0)}),i){var a={choice:i,word:n};e.dispatchEvent(new CustomEvent("emoji",{detail:a}))}})}(typer,chooser),function(e,t){var n=t.querySelector("form"),r=n.querySelector("input"),i=n.querySelector("button"),o="";e.addEventListener("query",function(e){var n=e.detail,i=null===n.text&&void 0!==n.focus;o=n.focus,t.hidden=!i,t.hidden&&(r.value="")});var a=function(e){i.disabled=!r.value};"input change".split(/\s+/).forEach(function(e){return r.addEventListener(e,a)}),n.addEventListener("submit",function(e){e.preventDefault(),n.classList.add("pending"),r.disabled=!0,i.disabled=!0;submit(r.value,o).then(function(e){return i.classList.add("success"),!1}).catch(function(e){return i.classList.add("failure"),console.warn("failed to submit emoji",e),!0}).then(function(e){n.classList.remove("pending"),r.disabled=!1,i.disabled=!1,r.value=""}).then(function(e){return new Promise(function(e,t){return window.setTimeout(e,2e3)})}).then(function(e){i.className=""})})}(typer,advanced);

//# sourceMappingURL=bundle.js.map
